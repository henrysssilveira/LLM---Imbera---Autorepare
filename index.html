<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RepareTools - Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">
    <div class="bg-white p-8 rounded shadow-md w-96">
        <h2 class="text-2xl font-bold mb-4">Login RepareTools</h2>
        
        <input type="text" id="re" placeholder="Digite seu RE" 
               class="w-full p-2 border rounded mb-4">
        
        <button onclick="fazerLogin()" 
                class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
            Entrar
        </button>
        
        <p id="mensagem" class="mt-4 text-red-500"></p>
    </div>

    <script>
        async function fazerLogin() {
            const re = document.getElementById('re').value;
            const mensagem = document.getElementById('mensagem');
            
            try {
                // Envia RE para seu webhook n8n
                const response = await fetch('https://flows.imberabrasil.com/webhook/authorization', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        onPremisesSamAccountName: re
                    })
                });
                
                const data = await response.json();
                
                // Verifica se recebeu token ou erro
                if (data.Token) {
                    // üçå GUARDA O TOKEN NO localStorage
                    localStorage.setItem('repareToolsToken', data.Token);
                    localStorage.setItem('tokenDatetime', data.Datetime);
                    
                    // Redireciona para p√°gina principal
                    window.location.href = 'dashboard.html';
                } else {
                    // Mostra erro
                    mensagem.textContent = data.Error || 'Erro ao fazer login';
                }
                
            } catch (error) {
                mensagem.textContent = 'Erro de conex√£o: ' + error.message;
            }
        }
    </script>
</body>
</html>
